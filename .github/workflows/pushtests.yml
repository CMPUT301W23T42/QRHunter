on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  java-doc:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: ${{github.head_ref}}
      - name: Setup JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'
      - name: Grant Execute Permissions for Gradlew
        run: chmod +x gradlew
      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2
      - name: Run Gradle Build
        run: ./gradlew build --parallel
      - name: Generate Javadocs
        run: ./gradlew createJavaDocs
      - name: Push Javadocs to Branch
        uses: datalbry/copy_folder_to_another_repo_action@1.0.0
        env:
          API_TOKEN_GITHUB: ${{ secrets.GITHUB_TOKEN }}
        with:
          source_folder: app/doc
          destination_repo: 'qrhunter/${{ github.head_ref }}'
          destination_folder: 'app'
          user_email: 'github-actions@github.com'
          user_name: 'github-actions'
          commit_msg: 'Generated Javadoc'

  java-docssss:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: ${{github.head_ref}}
      - name: Setup JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'
      - name: Push Javadocs to Branch
        run: |
          date > generated.txt
          git config user.name github-actions
          git config user.email github-actions@github.com
          git checkout ${{ github.head_ref }}
          git add .
          git commit -m "test push"
          git push